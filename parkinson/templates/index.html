<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroScan | Audio Analysis</title>
    <style>
        /* NeuroScan Design System */
        :root {
            --primary-light: #4da6ff;
            --primary-main: #2d87e0;
            --primary-dark: #1a66b3;
            --secondary-light: #a6d7ff;
            --secondary-main: #7bc0ff;
            --accent-teal: #2dc0c0;
            --accent-coral: #ff7a7a;
            --success-light: #6fcf97;
            --warning-light: #ffb74d;
            --light-gray: #f8fafc;
            --medium-gray: #e2e8f0;
            --dark-gray: #475569;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.08);
            --gradient-primary: linear-gradient(135deg, #4da6ff 0%, #2d87e0 100%);
            --gradient-secondary: linear-gradient(135deg, #7bc0ff 0%, #2dc0c0 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f4ff 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            color: var(--text-primary);
        }

        /* Main Container */
        .container {
            background: white;
            border-radius: 24px;
            box-shadow: var(--shadow-medium);
            padding: 40px;
            width: 100%;
            max-width: 900px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--medium-gray);
            margin-bottom: 40px;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gradient-primary);
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--primary-dark), var(--accent-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, rgba(77, 166, 255, 0.08), rgba(45, 192, 192, 0.08));
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 4px solid var(--accent-teal);
        }

        .info-box h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 1.2rem;
        }

        .info-box ul {
            margin: 0;
            padding-left: 20px;
            color: var(--text-secondary);
        }

        .info-box li {
            margin-bottom: 8px;
        }

        /* Warning Box */
        .warning-box {
            background: linear-gradient(135deg, rgba(255, 122, 122, 0.1), rgba(255, 122, 122, 0.05));
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 40px;
            border-left: 4px solid var(--accent-coral);
        }

        .warning-box h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .warning-box p {
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.6;
        }

        .warning-box .warning-icon {
            color: var(--accent-coral);
            font-size: 1.3rem;
        }

        /* Button Group */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        /* Buttons */
        button {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        #recordBtn {
            background: var(--gradient-primary);
            color: white;
        }

        #recordBtn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(77, 166, 255, 0.4);
        }

        #recordBtn:disabled {
            background: var(--medium-gray);
            color: var(--text-secondary);
            cursor: not-allowed;
            box-shadow: none;
        }

        #stopBtn {
            background: linear-gradient(135deg, #ff7a7a 0%, #e74c3c 100%);
            color: white;
        }

        #stopBtn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 122, 122, 0.4);
        }

        #stopBtn:disabled {
            background: var(--medium-gray);
            color: var(--text-secondary);
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Analyze and Back Buttons Container */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .action-button {
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-decoration: none;
            text-align: center;
        }

        #sendBtn {
            background: linear-gradient(135deg, #6fcf97 0%, #27ae60 100%);
            color: white;
            border: none;
            cursor: pointer;
        }

        #sendBtn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(111, 207, 151, 0.4);
        }

        #sendBtn:disabled {
            background: var(--medium-gray);
            color: var(--text-secondary);
            cursor: not-allowed;
            box-shadow: none;
        }

        .back-home-btn {
            background: linear-gradient(135deg, var(--secondary-main), var(--accent-teal));
            color: white;
        }

        .back-home-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(123, 192, 255, 0.4);
        }

        /* Audio Section */
        .audio-section {
            background: var(--light-gray);
            border-radius: 16px;
            padding: 30px;
            margin: 40px 0;
            border: 2px dashed var(--medium-gray);
            text-align: center;
        }

        .audio-label {
            display: block;
            margin-bottom: 20px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Recording Visualizer */
        .recording-visualizer {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 12px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
            display: none;
        }

        .recording-info {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            z-index: 2;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background-color: #ff4757;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Wave Animation */
        .wave-animation {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 4px;
            padding: 30px;
        }

        .wave-bar {
            width: 4px;
            background: linear-gradient(to top, var(--primary-light), var(--accent-teal));
            border-radius: 2px;
            animation: wave 1.2s ease-in-out infinite;
            animation-delay: calc(var(--i) * 0.1s);
        }

        @keyframes wave {
            0%, 100% {
                height: 20%;
            }
            50% {
                height: 80%;
            }
        }

        /* Audio Playback */
        .audio-playback {
            width: 100%;
            border-radius: 10px;
            margin: 15px 0;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: var(--light-gray);
            border-radius: 16px;
        }

        .spinner {
            border: 4px solid rgba(77, 166, 255, 0.2);
            border-top: 4px solid var(--primary-main);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
            margin: 10px 0;
        }

        /* Results */
        .result {
            margin-top: 40px;
            padding: 35px;
            border-radius: 16px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            box-shadow: var(--shadow-light);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            display: none;
        }

        .normal {
            background: linear-gradient(135deg, rgba(111, 207, 151, 0.1) 0%, rgba(111, 207, 151, 0.2) 100%);
            color: #155724;
            border-color: #6fcf97;
        }

        .parkinson {
            background: linear-gradient(135deg, rgba(255, 122, 122, 0.1) 0%, rgba(255, 122, 122, 0.2) 100%);
            color: #721c24;
            border-color: #ff7a7a;
        }

        .result h2 {
            margin-bottom: 15px;
            font-size: 1.6rem;
        }

        .result p {
            margin: 15px 0;
            font-weight: normal;
            font-size: 1.1rem;
        }

        /* Features Section */
        .features-section {
            margin-top: 40px;
            padding: 30px;
            background: var(--light-gray);
            border-radius: 16px;
            display: none;
        }

        .features-section h3 {
            color: var(--text-primary);
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.4rem;
            position: relative;
            padding-bottom: 15px;
        }

        .features-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }

        .features-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }

        .features-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
        }

        .features-table td {
            padding: 15px;
            border-bottom: 1px solid var(--medium-gray);
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
        }

        .features-table tr:last-child td {
            border-bottom: none;
        }

        .features-table tr:hover td {
            background: rgba(77, 166, 255, 0.05);
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 60px;
            padding: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-top: 1px solid var(--medium-gray);
            width: 100%;
            max-width: 900px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 20px;
            }

            .container {
                padding: 30px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .button-group {
                flex-direction: column;
                align-items: center;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            button, .action-button {
                width: 100%;
                max-width: 300px;
            }

            .features-table {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .button-group {
                gap: 15px;
            }
            
            .action-buttons {
                gap: 15px;
            }
            
            button, .action-button {
                padding: 14px 20px;
                min-width: unset;
                width: 100%;
            }
        }
    </style>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>NeuroScan Audio Analysis</h1>
            <p>Record your voice for Parkinson's disease detection using advanced AI analysis</p>
        </div>

        <!-- Info Box -->
        <div class="info-box">
            <h3>
                <i class="fas fa-info-circle" style="color: var(--accent-teal);"></i>
                Recording Instructions
            </h3>
            <ul>
                <li>Click "Start Recording" to begin</li>
                <li>Pronounce the vowel "A" clearly for 3-5 seconds</li>
                <li>Speak at normal distance from microphone</li>
                <li>Click "Stop Recording" when finished</li>
                <li>Click "Analyze Voice" for results</li>
            </ul>
        </div>

        <!-- Warning Box -->
        <div class="warning-box">
            <h4>
                <i class="fas fa-exclamation-triangle warning-icon"></i>
                Important Note on Accuracy
            </h4>
            <p>
                This is a demonstration tool. Results obtained may not be accurate because the recording 
                conditions and environment are different from the original UCI Parkinson's dataset. The 
                original dataset was recorded in controlled medical settings with specialized equipment, 
                while this demo uses your current microphone in your environment. For medical diagnosis, 
                please consult a healthcare professional.
            </p>
        </div>

        <!-- Recording Controls -->
        <div class="button-group">
            <button id="recordBtn">
                <i class="fas fa-microphone"></i> Start Recording
            </button>
            <button id="stopBtn" disabled>
                <i class="fas fa-stop"></i> Stop Recording
            </button>
        </div>

        <!-- Recording Visualizer -->
        <div id="recordingVisualizer" class="recording-visualizer">
            <div class="recording-info">
                <div class="recording-dot"></div>
                <span>Recording in progress...</span>
            </div>
            <div class="wave-animation" id="waveAnimation"></div>
        </div>

        <!-- Audio Section -->
        <div class="audio-section">
            <span class="audio-label">
                <i class="fas fa-headphones"></i> Your Recorded Audio
            </span>
            <audio id="audioPlayback" class="audio-playback" controls></audio>
        </div>

        <!-- Action Buttons (Analyze and Back Home) -->
        <div class="action-buttons">
            <button id="sendBtn" disabled>
                <i class="fas fa-chart-line"></i> Analyze Voice
            </button>
            <a href="/" class="action-button back-home-btn">
                <i class="fas fa-home"></i> Back to Home
            </a>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Analysis in progress...</p>
            <p style="color: var(--text-secondary); font-size: 0.95rem;">
                Extracting 22 vocal features and running AI prediction
            </p>
        </div>

        <!-- Results -->
        <div id="result" class="result"></div>

        <!-- Features Section -->
        <div id="features" class="features-section">
            <h3>
                <i class="fas fa-table"></i>
                Extracted Vocal Features
            </h3>
            <table class="features-table" id="featuresTable">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Normalized Value</th>
                    </tr>
                </thead>
                <tbody id="featuresBody">
                    <!-- Features will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>NeuroScan Project | Academic Research | Parkinson's Disease Detection</p>
        <p>Results are for educational purposes only. Always consult healthcare professionals for medical diagnosis.</p>
    </div>

    <!-- JavaScript -->
    <script>
        let mediaRecorder;
        let audioChunks = [];

        const recordBtn = document.getElementById("recordBtn");
        const stopBtn = document.getElementById("stopBtn");
        const sendBtn = document.getElementById("sendBtn");
        const audioPlayback = document.getElementById("audioPlayback");
        const recordingVisualizer = document.getElementById("recordingVisualizer");
        const waveAnimation = document.getElementById("waveAnimation");
        const resultDiv = document.getElementById("result");
        const loadingDiv = document.getElementById("loading");
        const featuresDiv = document.getElementById("features");
        const featuresBody = document.getElementById("featuresBody");

        // Create wave animation
        function createWaveAnimation() {
            waveAnimation.innerHTML = '';
            for (let i = 0; i < 40; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                bar.style.setProperty('--i', i);
                waveAnimation.appendChild(bar);
            }
        }

        // Initialize wave animation
        createWaveAnimation();

        recordBtn.onclick = async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });

                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'audio/webm;codecs=opus'
                });

                audioChunks = [];
                mediaRecorder.start();

                // Show recording visualizer
                recordingVisualizer.style.display = 'block';

                mediaRecorder.ondataavailable = e => {
                    if (e.data.size > 0) {
                        audioChunks.push(e.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    audioPlayback.src = URL.createObjectURL(audioBlob);

                    // Stop microphone stream
                    stream.getTracks().forEach(t => t.stop());

                    // Hide recording visualizer
                    recordingVisualizer.style.display = 'none';

                    // Enable analyze button
                    sendBtn.disabled = false;
                };

                // Update UI
                recordBtn.disabled = true;
                stopBtn.disabled = false;
                resultDiv.style.display = "none";
                featuresDiv.style.display = "none";

            } catch (error) {
                console.error("Microphone error:", error);
                resultDiv.innerHTML = `<div class="parkinson">Error: Cannot access microphone</div>`;
                resultDiv.style.display = "block";
            }
        };

        stopBtn.onclick = () => {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                recordBtn.disabled = false;
                stopBtn.disabled = true;
            }
        };

        sendBtn.onclick = async () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });

            loadingDiv.style.display = "block";
            sendBtn.disabled = true;
            resultDiv.style.display = "none";

            const formData = new FormData();
            formData.append('voice', audioBlob, 'voice.webm');

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.error) {
                    resultDiv.innerHTML = `<div class="parkinson">Error: ${data.error}</div>`;
                } else {
                    const statusClass = data.prediction === 1 ? 'parkinson' : 'normal';
                    const confidence = (data.probability * 100).toFixed(2);
                    const statusText = data.prediction === 1 ? 
                        "Potential Parkinson's Indicators Detected" : 
                        "No Parkinson's Indicators Detected";

                    resultDiv.innerHTML = `
                        <div class="${statusClass}">
                            <h2>${statusText}</h2>
                            <p>Confidence Score: ${confidence}%</p>
                            <p style="font-size: 0.95rem; color: var(--text-secondary); margin-top: 20px;">
                                <i class="fas fa-info-circle"></i> Note: This analysis is based on 22 vocal features. 
                                Results are for demonstration purposes only due to different recording conditions.
                            </p>
                        </div>
                    `;

                    // Display normalized features
                    if (data.features_normalized) {
                        featuresBody.innerHTML = "";

                        for (const [feature, value] of Object.entries(data.features_normalized)) {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td>${feature}</td>
                                <td>${value.toFixed(6)}</td>
                            `;
                            featuresBody.appendChild(row);
                        }

                        featuresDiv.style.display = "block";
                    }
                }

            } catch (error) {
                console.error("Error:", error);
                resultDiv.innerHTML = `<div class="parkinson">Server connection error</div>`;
            } finally {
                loadingDiv.style.display = "none";
                sendBtn.disabled = false;
                resultDiv.style.display = "block";
            }
        };
    </script>
</body>
</html>